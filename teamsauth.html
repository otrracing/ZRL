<!DOCTYPE html>
<html>
<head>
    <title>Rider Login</title>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h2>Teams List</h2>

    <!-- Login Area -->
    <div id="login-area">
        <input type="email" id="email" placeholder="Enter your email" required />
        <input type="text" id="riderId" placeholder="Enter your rider ID" required />
        <button onclick="login()">Sign In</button>
    </div>

    <!-- User Info and Logout -->
    <div id="user-info" style="display:none;">
        <span>Signed in as: <span id="user-name"></span></span>
        <button onclick="logout()">Sign Out</button>
    </div>

    <table id="teamsTable">
        <thead>
            <tr><th>Team Name</th><th>Other Info</th></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const webAppUrl = "YOUR_WEB_APP_URL"; // Replace with your Apps Script web app URL

        function login() {
            const email = document.getElementById("email").value;
            const riderId = document.getElementById("riderId").value;

            // Check if email and riderId are entered
            if (!email || !riderId) {
                alert("Please enter both email and rider ID.");
                return;
            }

            // Send credentials to Apps Script for validation
            fetch(webAppUrl, {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `email=${encodeURIComponent(email)}&riderId=${encodeURIComponent(riderId)}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.isValid) {
                    // If valid, save in localStorage and display user info
                    localStorage.setItem("riderEmail", email);
                    displayUser(email);
                    fetchTeams(); // Fetch data if the user is verified
                } else {
                    alert("Invalid email or rider ID. Please try again.");
                }
            })
            .catch(error => console.error("Error during login:", error));
        }

        function logout() {
            localStorage.removeItem("riderEmail");
            location.reload();
        }

        function displayUser(email) {
            document.getElementById("login-area").style.display = "none";
            document.getElementById("user-info").style.display = "block";
            document.getElementById("user-name").innerText = email;
        }

        function checkLogin() {
            const email = localStorage.getItem("riderEmail");
            if (email) {
                displayUser(email);
                fetchTeams(); // Fetch data if the user is "logged in"
            }
        }

        async function fetchTeams() {
            const url = "YOUR_TEAMS_DATA_URL"; // Replace with your data URL

            try {
                const response = await fetch(url);
                const data = await response.json();
                const tableBody = document.querySelector("#teamsTable tbody");

                data.forEach((row) => {
                    const rowElement = document.createElement("tr");
                    rowElement.innerHTML = `<td>${row.teamName}</td><td>${row.otherInfo}</td>`;
                    tableBody.appendChild(rowElement);
                });
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        checkLogin(); // Check if the user is already logged in on page load
    </script>
</body>
</html>
